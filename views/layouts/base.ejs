<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <%
      const rawTitle = typeof pageTitle === 'string' && pageTitle.trim() ? pageTitle.trim() : '';
      const sectionTitles = {
        '/activos': 'Activos fijos',
        '/incidencias': 'Incidencias',
        '/incidencias/reportes': 'Reportes de diagnÃ³stico',
        '/bajas': 'Reportes de baja',
        '/usuarios': 'Usuarios',
        '/login': 'Iniciar sesiÃ³n'
      };
      const normalizedPath = typeof currentPath === 'string' ? currentPath.split('?')[0] : '';
      const fallbackTitle =
        sectionTitles[normalizedPath] || sectionTitles[currentSection] || 'Panel administrativo';
      const resolvedTitle = rawTitle || fallbackTitle;
      const pageDocumentTitle = `${resolvedTitle} Â· Control de Activos`;
      const displayName = user
        ? [user?.nombre, user?.apellido].filter(Boolean).join(' ') || user?.nombre || 'Cuenta'
        : '';
      const userRole = user?.rol || 'Sin rol';
    %>
    <title><%= pageDocumentTitle %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="<%= user ? 'app-body' : 'public-body' %>">
    <% if (user) { %>
      <div class="app-shell">
        <aside class="app-sidebar">
          <div class="app-sidebar__brand">
            <div class="app-sidebar__logo" aria-hidden="true">ğŸ’¼</div>
            <div class="app-sidebar__brand-text">
              <p class="app-sidebar__title">Control de activos</p>
              <p class="app-sidebar__subtitle">Panel administrativo</p>
            </div>
          </div>
          <nav class="app-sidebar__nav" aria-label="Secciones principales">
            <a
              href="/activos"
              class="app-sidebar__link <%= currentSection === '/activos' ? 'is-active' : '' %>"
            >
              <span aria-hidden="true">ğŸ“¦</span>
              <span>Activos fijos</span>
            </a>
            <a
              href="/incidencias"
              class="app-sidebar__link <%= currentSection === '/incidencias' && !normalizedPath.startsWith('/incidencias/reportes') ? 'is-active' : '' %>"
            >
              <span aria-hidden="true">ğŸ› ï¸</span>
              <span>Incidencias</span>
            </a>
            <a
              href="/bajas"
              class="app-sidebar__link <%= currentSection === '/bajas' ? 'is-active' : '' %>"
            >
              <span aria-hidden="true">ğŸ“Š</span>
              <span>Reportes de baja</span>
            </a>
          </nav>
          <div class="app-sidebar__footer">
            <form action="/logout" method="post" class="app-sidebar__logout-form">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit" class="app-sidebar__logout-btn">Cerrar sesiÃ³n</button>
            </form>
          </div>
        </aside>
        <div class="app-shell__content">
          <header class="app-topbar">
            <div>
              <h1 class="app-topbar__title"><%= resolvedTitle %></h1>
              <% if (typeof subtitle === 'string' && subtitle.trim()) { %>
                <p class="app-topbar__subtitle"><%= subtitle.trim() %></p>
              <% } %>
            </div>
            <div class="app-topbar__user" aria-label="Usuario activo">
              <span class="app-topbar__user-icon" aria-hidden="true">ğŸ‘¤</span>
              <div class="app-topbar__user-info">
                <span class="app-topbar__user-name"><%= displayName %></span>
                <span class="app-topbar__user-role"><%= userRole %></span>
              </div>
            </div>
          </header>
          <main class="app-main">
            <%- typeof content === 'string' ? content : '' %>
            <%- typeof body !== 'undefined' ? body : '' %>
          </main>
        </div>
      </div>
    <% } else { %>
      <div class="public-container">
        <header class="public-header">
          <h1>Control de activos</h1>
          <p class="public-subtitle">Panel administrativo</p>
        </header>
        <main class="public-main">
          <%- typeof content === 'string' ? content : '' %>
          <%- typeof body !== 'undefined' ? body : '' %>
        </main>
      </div>
    <% } %>
  </body>
</html>
