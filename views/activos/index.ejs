<%- include('../layouts/base', { body: `
  <section>
    <div class="activos-header">
      <h2>Activos</h2>
      <button type="button" id="toggleActivos" class="btn-toggle" data-view="${mostrarFormulario ? 'form' : 'list'}">
        ${mostrarFormulario ? 'Ver lista' : 'Registrar activo'}
      </button>
    </div>

    ${ok ? `<div class="ok">Activo guardado correctamente</div>` : ''}
    ${errores && errores.length ? `<div class="alert">${errores.map(e => `<div>${e}</div>`).join('')}</div>` : ''}

    <div id="panelListaActivos" class="${mostrarFormulario ? 'oculto' : ''}">
      ${activos.length ? `
        <div class="tabla-contenedor">
          <table class="tabla-activos">
            <thead>
              <tr>
                <th>#</th>
                <th>Categoría</th>
                <th>Área</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Estado</th>
                <th>Fecha adquisición</th>
                <th>Precio lista</th>
                <th>Número de serie</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              ${activos.map((activo, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td>${activo.categoria || '—'}</td>
                  <td>${activo.area || '—'}</td>
                  <td>${activo.marca || '—'}</td>
                  <td>${activo.modelo || '—'}</td>
                  <td>${activo.estado || '—'}</td>
                  <td>${activo.fechaAdquisicionTexto || '—'}</td>
                  <td>${activo.precioListaTexto || (activo.precio_lista ?? '—')}</td>
                  <td>${activo.numero_serie || '—'}</td>
                  <td class="acciones">
                    <a class="btn-link" href="/activos/${activo.id_activo}">Ver</a>
                    <a class="btn-link" href="/activos/${activo.id_activo}/editar">Editar</a>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      ` : '<p>No hay activos registrados por el momento.</p>'}
    </div>

    <div id="panelFormularioActivos" class="${mostrarFormulario ? '' : 'oculto'}">
      <h3>Registrar nuevo activo</h3>
      <form method="post" action="/activos">
        <label>Categoría</label>
        <select name="id_categoria_activos" required>
          ${categorias.map(c => `
            <option value="${c.id_categoria_activos}" ${String((values && values.id_categoria_activos) ?? '') === String(c.id_categoria_activos) ? 'selected' : ''}>${c.nombre}</option>
          `).join('')}
        </select>

        <label>Área</label>
        <select name="id_area" required>
          ${areas.map(a => `
            <option value="${a.id_area}" ${String((values && values.id_area) ?? '') === String(a.id_area) ? 'selected' : ''}>${a.nombre_area}</option>
          `).join('')}
        </select>

        <label>Marca</label>
        <input name="marca" maxlength="50" value="${(values && values.marca) ? values.marca : ''}">

        <label>Modelo</label>
        <input name="modelo" maxlength="50" value="${(values && values.modelo) ? values.modelo : ''}">

        <label>Estado</label>
        <input name="estado" maxlength="50" required value="${(values && values.estado) ? values.estado : ''}">

        <label>Fecha de adquisición</label>
        <input type="date" name="fecha_compra" value="${(values && values.fecha_compra) ? values.fecha_compra : ''}">

        <label>Precio lista</label>
        <input type="number" step="0.01" name="precio_lista" value="${(values && values.precio_lista) ? values.precio_lista : ''}">
        
        <label>Número de serie</label>
        <input name="numero_serie" maxlength="100" value="${(values && values.numero_serie) ? values.numero_serie : ''}">

        <input type="hidden" name="_csrf" value="${csrfToken}">
        <button>Guardar</button>
      </form>
    </div>
  </section>
  <script>
    (() => {
      const toggleBtn = document.getElementById('toggleActivos');
      const lista = document.getElementById('panelListaActivos');
      const formulario = document.getElementById('panelFormularioActivos');
      if (!toggleBtn || !lista || !formulario) return;

      let mostrandoFormulario = toggleBtn.dataset.view === 'form';

      const actualizarVista = () => {
        if (mostrandoFormulario) {
          formulario.classList.remove('oculto');
          lista.classList.add('oculto');
          toggleBtn.textContent = 'Ver lista';
        } else {
          formulario.classList.add('oculto');
          lista.classList.remove('oculto');
          toggleBtn.textContent = 'Registrar activo';
        }
        toggleBtn.dataset.view = mostrandoFormulario ? 'form' : 'list';
      };

      actualizarVista();

      toggleBtn.addEventListener('click', () => {
        mostrandoFormulario = !mostrandoFormulario;
        actualizarVista();
      });
    })();
  </script>
` }) %>

